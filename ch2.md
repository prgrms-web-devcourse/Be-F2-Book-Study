## 자바 프로그램의 개발과 구동

자바 개발 도구인 JDK를 이용해 개발된 프로그램인 JRE에 의해 가상의 컴퓨터인 JVM 상에서 구동된다.

객체 지향 프로그램에서는 데이터 저장 영역을 세 개의 영역으로 분할해서 사용한다.

### 데이터 저장 영역(T 메모리 구조)

- 스태틱(Static) 영역
- 스택(Stack) 영역
- 힙(Heap) 영역

### 프로그램 실행 순서

- JRE는 먼저 main() 메서드가 있는지 확인한다.
- main() 메서드의 존재가 확인되면 JRE는 프로그램 실행을 위한 사전 준비 - JVM에 전원을 넣어 부팅
- JVM은 메모리 구조를 만들고 패키지 로딩, 각종 클래스 로딩, main() 메서드 스택 프레임 배치, 변수 공간 배치 등등의 일을 처리한다.
- main() 메서드가 실행되기 전 JVM에서 수행하는 **전처리** 작업
  - JVM은 가장 먼저 java.lang 패키지를 T 메모리의 스태틱 영역에 배치한다.
  - import된 패키지를 T 메모리의 스태틱 영역에 배치한다.
  - 프로그램 상의 모든 클래스를 T 메모리의 스태틱 영역에 배치한다.
- main() 스택 프레임이 스택 영역에 할당된다. (여는 중괄호를 만날 때마다 스택 프레임이 하나씩 생긴다.)
- 메서드의 인자(args)들을 저장할 변수 공간을 할당한다.
- 닫는 중괄호로 스택 프레임이 소멸된다.
- main() 메서드가 끝나면 JRE는 JVM을 종료하고 JRE 자체도 운영체제 상의 메모리에서 사라진다. - T 메모리도 사라진다.



## 변수와 메모리

| 변수             |                                                              |
| ---------------- | ------------------------------------------------------------ |
| 지역변수         | 스택 영역-스택 프레임 내, 스택 프레임이 사라지면 함께 사라진다. |
| 클래스 멤버 변수 | 스태틱 영역, JVM이 종료될 때까지                             |
| 객체 멤버 변수   | 힙 영역, 객체와 함께 가비지 컬렉터에 의해                    |

외부 스택 프레임에서 내부 스택 프레임의 변수에 접근하는 것은 불가능하나 그 역은 가능하다.

스택 메모리 내의 스택 프레임 안의 변수를 지역 변수라고 한다. 그 지역(스택 프레임)에서만 사용할 수 있고 외부에서는 사용할 수 없기 때문이다. 그 지역이 사라지면 지역 변수도 메모리에서 함께 사라진다.

메서드 사이에 값을 전달하거나 반환하는 방법은 **메서드의 인자**와 **반환값**으로만 가능하다. 

전역 변수(공유 변수)는 가급적 사용하지 않는다.

- 프로젝트 규모에 따라 코드가 커지면서 여러 메서드에서 전역 변수의 값을 변경하기 시작하면 T 메모리로 추적하지 않는 이상 전역 변수에 저장돼 있는 값을 파악하기 쉽지 않다.
- 다른 메서드에 의해 전역 변수에 다른 값이 저장된다면 코드를 추적해 들어가야만 값과 그 값이 변한 이유를 파악할 수 있다. - 아주 어렵고 힘든 작업
- 읽기 전용으로 값을 공유해서 전역 상수로 쓰는 것은 적극 추천한다.



## 멀티 스레드 / 멀티 프로세스

| 멀티 스레드                                                  | 멀티 프로세스                                                |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 스택 영역을 스레드 개수만큼 분할해서 쓴다.                   | 다수의 데이터 저장 영역 - 다수의 T 메모리를 갖는 구조        |
| 하나의 T 메모리만 사용 - 스택 영역만 분할해서 사용하는 구조  | 각 프로세스마다 각자의 T 메모리가 있고 각자 고유의 공간 -> 서로 참조할 수 없다. |
| 하나의 스레드에서 다른 스레드의 스택 영역에는 접근할 수 없지만 스태틱 영역과 힙 영역은 공유해서 사용하는 구조 -> 메모리를 적게 사용할 수 있다. | 하나의 프로세스가 다른 프로세스의 T 메모리 영역을 절대 침범할 수 없는 메모리 안전한 구조 ->  메모리 사용량은 그만큼 크다. |